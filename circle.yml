machine:
  environment:
    PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"
  timezone:
    Asia/Tokyo

dependencies:
  override:
    - yarn
    - sudo pip install awscli
  post:
    - aws configure set region ap-northeast-1

test:
  override:
    - echo "Run test script here."
    - make clean-node-modules clean-dist
    - make node-modules
    - make build

deployment:
  all:
    branch: release
    commands:
      - make clean-node-modules clean-dist
      - make node-modules-production
      - make build
      - aws s3 sync dist/ s3://dungeonkeys.io/ --delete --cache-control "no-cache"
